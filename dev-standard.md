# 开发技术指南
<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [开发技术指南](#开发技术指南)
	- [1 文档说明](#1-文档说明)
		- [1.1 CHANGELOG](#11-changelog)
		- [1.2 规范目标](#12-规范目标)
	- [2 开发环境](#2-开发环境)
		- [2.1 运行环境及开发工具](#21-运行环境及开发工具)
		- [2.2 中间件](#22-中间件)
		- [2.3 数据库](#23-数据库)
		- [2.4 svn](#24-svn)
		- [2.5 字符编码](#25-字符编码)
	- [3 项目规范](#3-项目规范)
		- [3.1 项目结构](#31-项目结构)
		- [3.2 应用分层](#32-应用分层)
		- [3.3 单元测试](#33-单元测试)
	- [4 编码规范](#4-编码规范)
		- [4.1 源文件基本要素](#41-源文件基本要素)
		- [4.2 源文件结构](#42-源文件结构)
		- [4.3 编程格式](#43-编程格式)
		- [4.4 命名](#44-命名)
		- [4.5 编程实践](#45-编程实践)
		- [4.6 Javadoc](#46-javadoc)
	- [5 安全规范](#5-安全规范)
		- [5.1 防止XSS](#51-防止xss)
		- [5.2 防SQL注入](#52-防sql注入)
		- [5.3 线程安全](#53-线程安全)
		- [5.4 敏感数据](#54-敏感数据)
			- [5.4.1 数据分类](#541-数据分类)
			- [5.4.2 数据展示](#542-数据展示)
			- [5.4.3 数据存储](#543-数据存储)
			- [5.4.4 数据传输](#544-数据传输)

<!-- /TOC -->

## 1 文档说明
### 1.1 CHANGELOG
* v1.0.S2 (2016-09-27)
  - [#4] 添加CHANGELOG
  - [#3] 重新整理安全规范-敏感数据部分
  - [#2] 添加IBS项目组技术栈  
* v1.0.S1(2016-08-19)
  - [#1] 整理初稿

### 1.2 规范目标
和其他规范指南一样，规范不仅包括了代码的结构美学，也包括了其他一些业界约定俗成的公约和普遍采用的标准；同时文档中的规范也包含了公司内部已经达成共识的标准，尽量避免去定义那些还存在争议的地方。本规范目标：
* 规范了公司采用的技术范畴，利于推广统一技术
* 对采用的技术给出使用指南
* 遵循约定优于同质重写, 约定优于拷贝, 约定优于配置

## 2 开发环境
### 2.1 运行环境及开发工具
* 运行环境
  * 目前公司应用系统绝大部分运行环境为JDK1.6
  * 规范定义应用系统必须开发、运行于JDK1.6上
* 开发工具
  * Eclipse (建议luna版本及其以下, luna是支持jdk1.6最高版本)
  * Intellij IDEA
* 第三方工具及库
  * Maven
    * settings.xml  
    公司nexus地址: http://maven.99wuxian.com/nexus/index.html
  * spring
    * 3.1.4.RELEASE  
	* spring-boot
	  * 1.4.0.RELEASE

### 2.2 中间件
* jboss 5.1.0
* tomcat6, tomcat7  

### 2.3 数据库
* oracle 11g
* Redis 2.6.14

### 2.4 svn
* 术语
  * trunk：svn主干名称；主干（trunk）代码永远是上线分支代码的一份拷贝，任何人、任何项目都不能在主干上直接修改代码。
  * branch：svn分支；项目开发分支。项目开发全部在该分支上进行的。整个项目流程结束，即上线完成以后，本项目即为上线分支。
  * hotfix：临时解决重大bug的补丁
* svn提交
  * 提交格式：项目名称|bug号：提交原因
  * 如果是修改bug，请在提交时，填写对应的bug号码，否则填写项目名称。
    * 提交原因，明确提交的内容、或解决的具体问题。
    * 同一问题的多个文件尽量一次性提交

### 2.5 字符编码
* 源代码需要采用GB18030（或者GBK，GB2312）编码，该设置在开发工具中必须提前设置保持一致。

## 3 项目规范
### 3.1 项目结构
* JEE  
```      
  src/
    main/
      java/
      resource/
      webapp/
        bower_components/
        img/
        js/
        css/
        pages/
        WEB-INF/
          web.xml
        bower.json
        index.html(index.ftl, index.jsp)
    test/
      java/
      resources/
  doc/
  pom.xml
  README.md
```
* Java
```      
  src/
    main/
      java/
      resource/
    test/
      java/
      resources/
  doc/
  pom.xml
  README.md
```

### 3.2 应用分层  
* web  
web框架使用springMVC，View模板用Velocity
* service  
业务逻辑层：按业务模块划分，可以调用多个dao；当业务逻辑较复杂时候，可以组合多个service为Facade给web层调用
* dao  
数据访问对象：隔离数据库访问与业务逻辑；
* model  
领域模型：dto(数据传输对象),entity(即po: 与db映射),vo(视图对象)
  * entity主要服务与dao层，用来与db映射
  * 目前公司web与service交互采用dubbo的方式，RPC调用的数据传输对象必须实现序列化
  * vo用来在页面与web层之间映射
* common
  * util
    * 原则上优先使用apache的commons-lang及google的guava工具包
    * 其他工具(例:字符串,序列化,时间...)保持同一份
  * 日志
    * 日志级别
      * debug  
      程序员打印跟踪信息，稳定的生产系统不打印该级别日志
      * info  
      重要步骤和显示信息的日志输出，生产系统通常会打印该级别日志
      * warn  
      不影响程序和系统的运行，但是该信息提示系统或流程有异常情况发生，需要进行检查，生产系统必需打印该级别日志
      * error  
      影响到程序的执行结果，提示错误发生，需要进行检查，生产系统必需打印该级别日志
      * fatal  
      会影响到整个系统的运行，无法继续提供服务或者类似的重大错误，生产系统必需打印该级别日志
    * 日志格式
      * 类似：%-d{yyyy-MM-dd HH:mm:ss,SSS} [%p] %l - %m%n
      * 必须含以下信息：d:时间 p:日志级别 l:日志定位 m:日志信息
  * exception
    * 应用级异常
      * 必须定义应用异常的错误代码，以及错误原因；
      * 错误代码采用统一的规则定义：应用代码+错误代码；
      * 错误原因，用明确的语言说明，发生错误的具体原因，方便bug调试，问题查找；
    * 系统级异常  
    在服务接口实现中，将系统级的异常（越界、空指针等）捕获，并将其转化为应用级异常抛出。系统级的异常错误代码定义为预留值9999，代码规范如下：  
    ```
      try {
      	merchantService.addMerchant(“abc”);
      } catch (DBException ex) {
      	logger.error(ex.getErrorMsg(), ex):
      	tdrow new MerchantTransException(ex.getErrorCode(), ex.getErrorMsg(), ex);
      } catch (Exception ex) {
      	logger.fatal(ex.getMessage(), ex);
      	tdrow new MerchantTransException(ErrorCodes. SYS_ERROR, ex.getMessage(), ex);
      }   
    ```   
    * 错误信息显示  
    所有应用中错误文本都使用工具类ErrorMsgUtil，根据异常的错误代码在属性文件（error.properties文件）中查找对应的错误提示信息。使用方式如下：  
    ```
    ErrorMsgUtil.getInstance(“error.properties”). getMessage(“S0001”,null);
    ```
  * cache
    * 优先使用spring自集成本地内存cache，如：
      * ConcurrentMap
      * Guava
      * EhCache
    * 需要在集群环境使用, 缓存量多，使用基础服务提供的Redis缓存

公司dao和service是放一起部署为核心层，web层单独部署；这两层都需要依赖model和common模块。

### 3.3 单元测试
* 推荐单元测试库
  * junit
	* easymock
  * mockito
* util类必须单元测试, service尽量mock  

## 4 编码规范  
基本的java代码编写规范应当符合Sun给出的Java语言代码约定中为基础（http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html ），以下部分为详细说明在代码中有明确严格定义的内容要求。

### 4.1 源文件基本要素
* 文件名  
源码文件名由它所包含的顶级class的类名（大小写敏感），加上.java后缀组成。
* 文件编码：GB2312
* 特殊字符
  * 空格字符  
  除了换行符外，ASCII空白字符（0x20）是源码文件中唯一支持的空格字符。这意味着：
    * 其他空白字符将被转义。
    * Tab字符不被用作缩进控制。
  * 特殊转义字符串  
  任何需要转义字符串表示的字符（例如\b, \t, \n, \f, \r, \', \\等），采用这种转义字符串的方式表示，而不采用对应字符的八进制数（例如 \012）或Unicode码（例如 \u000a）表示。

### 4.2 源文件结构  
源码文件按照先后顺序，由以下几部分组成：
* 版权, 作者, 日期, 类注释信息
* 包声明语句
  * 包声明的行，没有行长度的限制。单行长度限制不适用于包声明。
* import语句
  * 不应该使用通配符import，不管是否是静态导入。
  * import语句的行，没有行长度的限制。单行长度限制不适用于import语句所在行。
  * import语句应该被分为几个组，每个组之间由单行的空行隔开。分组的顺序如下：
    * 所有的static import为归为一组。
    * com.handpay 包的import归为一组。
    * 使用的第三方包的引用。每个顶级第三方包归为一组。例如：android, junit, guava, spring
    * java包归为一组。
    * javax包归为一组。
* 类声明  
  * 每个源码文件中只能有一个顶级class。
  * 类成员排序  
  类成员的顺序对代码的易读性有很大影响，但是没有一个统一正确的标准。不同的类可能有不同的排序方式。重要的是，每个class都要按照一定的逻辑规律排序。当被问及时，能够解释 清楚为什么这样排序。
  * 重载方法：不应该分开  
  当一个类有多个构造函数，或者多个同名成员方法时，这些函数应该写在一起，不应该被其他成员分开。  

每个部分之间应该只有一行空行作为间隔。

### 4.3 编程格式
* 花括号  
  * 花括号一般用在if, else, for, do, 和 while等语句。
  * 非空语句块采用K&R风格  
    * 左括号前不换行。
    * 左括号后换行。
    * 右括号前换行。
  * 空语句块  
  一个空的语句块，可以在左花括号之后直接接右花括号，中间不需要空格或换行。
* 语句块的缩进：4空格
* 一行最多只有一句代码  
每句代码的结束都需要换行。
* 行长度限制：80或100  
不同的项目可以选择采用80个字符或者100个字符作为限制。
* 空白
  * 所有保留的关键字与紧接它之后的位于同一行的左括号之间需要用空格隔开。（例如if、for、catch）
  * 所有保留的关键字与在它之前的右花括号之间需要空格隔开。（例如else、catch）
  * 在左花括号之前都需要空格隔开。只有两种例外：
    ```
    @SomeAnnotation({a, b})
    String[][] x = {{"foo"}};
    ```
  * 所有的二元运算符和三元运算符的两边，都需要空格隔开。
  * 逗号、冒号、分号和右括号之后，需要空格隔开。
  * // 双斜线开始一行注释时。双斜线两边都应该用空格隔开。并且可使用多个空格，但是不做强制要求。
  * 变量声明时，变量类型和变量名之间需要用空格隔开。
* 特殊结构
  * 枚举类型
  每个逗号后接一个枚举变量，不要求换行。例子：
  ```
  private enum Suit { CLUBS, HEARTS, SPADES, DIAMONDS }
  ```
  * 变量声明
    * 每次声明一个变量  
    不要采用一个声明，声明多个变量。例如 int a, b;
    * 当需要时才声明，尽快完成初始化  
    局部变量不应该习惯性地放在语句块的开始处声明，而应该尽量离它第一次使用的地方最近的地方声明，以减小它们的使用范围。
局部变量应该在声明的时候就进行初始化。如果不能在声明时初始化，也应该尽快完成初始化。
  * 数组
    * 数组初始化：可以类似块代码处理  
    所有数组的初始化，都可以采用和块代码相同的格式处理。例如以下格式都是允许的：
    ```
    new int[] {           new int[] {
        0, 1, 2, 3            0,
    }                       1,
                              2,
    new int[] {             3,
        0, 1,               }
        2, 3
    }                     new int[]
                              {0, 1, 2, 3}
    ```
    * 不能像C风格一样声明数组  
    方括号应该是变量类型的一部分，因此不应该和变量名放在一起。例如：应该是String[] args，而不是 String args[]
  * switch语句  
  每个switch语句中，都需要显式声明default标签。即使没有任何代码也需要显示声明。
  * Annotations
    * Annotations应用到类、函数或者构造函数时，每一行只有一个Annotations。
    ```
    @Override
    @Nullable
    public String getNameIfPresent() { ... }
    ```
    * Annotations应用到成员变量时，不同的是，多个annotations可以放在同一行。例如：  
    ```
    @Partial @Mock
    DataLoader loader;
    ```
  * 注释
  ```
  注释的缩进与它所注释的代码缩进相同。可以采用 /* */ 进行注释，也可以用 // 进行注释。
  当使用 /**/ 进行多行注释时，每一行都应该以 * 开始，并且 * 应该上下对齐。
  ```
  * 修饰符  
  多个类和成员变量的修饰符，按Java Lauguage Specification中介绍的先后顺序排序。具体是：
  ```
  public  protected  private  abstract  static  final  
  transient  volatile  synchronized  native  strictfp
  ```
  * 数字字面量  
  long型的字面量使用大写的L作为后缀, 绝不要使用小写l(避免与1混淆). 例如, 3000000000L而不是3000000000l

### 4.4 命名
* 标识符的通用规范  
标示符只应该使用字母、数字和下划线，字母大小写敏感。标示符不需要使用特殊的前缀或后缀，例如：name_, mName, s_name 和 kName。
* 不同类型的标示符规范
  * 包名  
  包名全部用小写字母，不应该使用下划线。
  * 类名  
  类型的命名，采用以大写字母开头的大小写字符间隔的方式（UpperCamelCase），class命名一般使用名词或名词短语。
  * 方法名  
  方法命名，采用以小写字母开头的大小写字符间隔的方式（lowerCamelCase），方法命名一般使用动词或者动词短语。
  另外建议方法最大不能超过50行。
  * 常量名  
  常量命名，全部使用大写字符，词与词之间用下划线隔开。（CONSTANCE_CASE）。
  * 非常量的成员变量名  
  非常量的成员变量命名（包括静态变量和非静态变量），采用lowerCamelCase命名。
  * 参数名  
  参数命名采用lowerCamelCase命名。
  * 局部变量名  
  局部变量采用lowerCamelCase命名。它相对于其他类型的命名，可以采用更简短宽松的方式。
* Camel case的定义  
有时一些短语被写成Camel case的时候可以有多种写法。例如一些缩写词汇，或者一些组合词：IPv6 或者 iOS 等。为了统一写法，给出了一种几乎可以确定为一种的写法。
```
     散体                  正确                       不建议
"XML HTTP request"	       XmlHttpRequest	             XMLHTTPRequest
"new customer ID"	         newCustomerId	             newCustomerID
"inner stopwatch"	         innerStopwatch	             innerStopWatch
"supports IPv6 on iOS?"	   supportsIpv6OnIos	         supportsIPv6OnIOS
"YouTube importer"	       YouTubeImporter             YoutubeImporter
```

### 4.5 编程实践
* @override 都应该使用  
@override annotations只要是符合语法的，都应该使用。
* 异常捕获 不应该被忽略
一般情况下，catch住的异常不应该被忽略，而是都需要做适当的处理。例如将错误日志打印出来，或者如果认为这种异常不会发生，则应该作为断言异常重新抛出。  
在测试类里，有时会针对方法是否会抛出指定的异常，这样的异常是可以被忽略的。但是这个异常通常需要命名为： expected。例如：
```
try {
    emptyStack.pop();
    fail();
} catch (NoSuchElementException expected) {
}
```
* 静态成员的访问：应该通过类，而不是对象  
当一个静态成员被访问时，应该通过class名去访问，而不应该使用这个class的具体实例对象。例如：
```
Foo aFoo = ...;
Foo.aStaticMetdod(); // good
aFoo.aStaticMetdod(); // bad
```

### 4.6 Javadoc
* 格式规范
  * 通用格式
    * 多行  
    ```
    /**
     * Multiple lines of Javadoc text are written here,
     * wrapped normally...
     */
    ```
    * 单行  
    ```
    /** An especially short bit of Javadoc. */
    ```
  * 段落  
  空白行：是指javadoc中，上下两个段落之间只有上下对齐的 * 字符的行。每个段落的第一行在第一个字符之前，有一个```<p>```标签。
  * @从句  
  所有标准的@从句，应该按照如下的顺序添加：@param、@return、@tdrows、@deprecated。并且这四种@从句，不应该出现在一个没有描述的Javadoc块中。
* 摘要片段  
每个类或者成员的javadoc，都是由一个摘要片段开始的。这个片段非常重要。因为它是类或者方法在使用时唯一能看到的文本说明。
* 何处应该使用Javadoc
  * 至少，Javadoc应该应用于所有的public类、public和protected的成员变量和方法。
  * 当方法本身很显而易见时，可以不需要javadoc。  
  例如：getFoo。没有必要加上javadoc说明“Returns tde foo”。
  * 例外：重载方法  
  重载方法有时不需要再写Javadoc。  

## 5 安全规范
### 5.1 防止XSS
* 跨站点脚本攻击防范原则
  * 一切的输入/输出都是有害的，不要信任任何输入/输出数据。
  * 所有传递过程都不能保障无侵入，执行前、存储前、显示前都要进行“数据清洁“。
  * 所有的数据校验、处理工作尽量在服务器端进行。
* 对安全要求较高的访问进行encode
  * HTML Encode  
  将输入/输出进行转义成HTML实体编码如：<转成```&lt;```
  * URL Encode   
  操作页面中DOM对象的时候，要对其输入的参数进行处理
  ```  
  Window.location=encodeURI(”http://www.99wuxian.com/test?page=1”);
  ```

### 5.2 防SQL注入
* 所有用户输入都比进行合法性校验。  
用户提交的数据都应该做合法性校验，避免用户输入‘，““，-，%，#,&,|，@，+等有可能导致SQL注入的危险字符
* 数据库SQL操作参数化。  
例如: 参数```b' or 1=1 --```绕过了原先的语义；此时如果sql参数化，预编译模块会重用执行计划从而防止SQL注入
```
select COUNT(*) from article where title = 'b'
select COUNT(*) from article where title = 'b' or 1=1 --'
```
* 尽量使用PreparedStatement代替Statement

### 5.3 线程安全  
尽量少用多线程，仅当业务需要多个线程操作时使用，使用时尽量遵循以下原则：    
* 使用原子类```java.util.concurrent.atomic```
* 使用tdreadLocal避免多个线程之间类成员的共享冲突。
* 尽量使用多线程框架```(java.util.concurrent)```构建多线程同步机制。
* 使用基础服务中的分布式锁

### 5.4 敏感数据  
本章节的主要目标是为了定义在系统中，所有需要进行保护的信息定义，对于隐私数据的范围，保护方式等进行严格定义。在整个系统的技术实现中作为基本规范，所有涉及到的信息都必须满足该内容要求。

#### 5.4.1 数据分类  
下表是目前系统中需要进行数据保护的敏感信息分类及说明：  
<table>
    <tr>
        <th>类型</th>
        <th>名称</th>
        <th>信息说明</th>
    </tr>
    <tr>
        <th rowspan="5">个人信息</th>
        <td>姓名</td>
        <td>用户真实姓名</td>
    </tr>
    <tr>
        <td>证件信息</td>
        <td>用户登记的证件类型，证件号码信息</td>
    </tr>
    <tr>
        <td>手机号码</td>
        <td>用户登记或者绑定的手机号码</td>
    </tr>
    <tr>
        <td>Email</td>
        <td>用户登记或者绑定的Email</td>
    </tr>
    <tr>
        <td>联系地址</td>
        <td>用户登记的联系地址，包括详细的省市街道，邮编等</td>
    </tr>
    <tr>
        <th rowspan="3">账户信息</th>
        <td>登录名</td>
        <td>系统中用户登记（或系统自动生成）的登录名，登录名在整个系统中是唯一的，可唯一标识一名用户</td>
    </tr>
    <tr>
        <td>安全问题</td>
        <td>用户设置用在忘记密码或者用户辅助的身份验证信息等</td>
    </tr>
    <tr>
        <td>卡号</td>
        <td>专指在系统中保存的用户个人所有的银行卡或者金融机构账户的号码</td>
    </tr>
    <tr>
        <th>商户</th>
        <td>商户信息</td>
        <td>商户在登记开户时所填写的商户基本信息，包括商户名，地址，联系方式等信息</td>
    </tr>
    <tr>
        <th rowspan="3">密码</th>
        <td>登录密码</td>
        <td>系统中用户登记（或系统自动生成）的登录名，登录名在整个系统中是唯一的，可唯一标识一名用户</td>
    </tr>
    <tr>
        <td>支付</td>
        <td>用户设置用在忘记密码或者用户辅助的身份验证信息等</td>
    </tr>
    <tr>
        <td>卡号</td>
        <td>专指在系统中保存的用户个人所有的银行卡或者金融机构账户的号码</td>
    </tr>
    <tr>
        <th rowspan="2">安全信息</th>
        <td>个人证书</td>
        <td>系统颁发给注册用户的证书，证书可能对应于不同的使用环境或者使用渠道，通常是文件方式或者是存储与特定的硬件设备中</td>
    </tr>
    <tr>
        <td>商户证书</td>
        <td>由系统给注册商户颁发的证书，通常用于商户在连接系统进行数据交换时使用</td>
    </tr>
    <tr>
        <th rowspan="5">交易信息</th>
        <td>交易商品信息</td>
        <td>交易订单中的明细商品信息，包括商品代码，供货商等</td>
    </tr>
    <tr>
        <td>交易流水号</td>
        <td>交易订单中可以唯一识别商户订单，订单的ID号码</td>
    </tr>
    <tr>
        <td>交易金额</td>
        <td>交易订单中的价格信息</td>
    </tr>
    <tr>
        <td>收获地址</td>
        <td>商品订单中用户输入的收货地址</td>
    </tr>
    <tr>
        <td>收获人信息</td>
        <td>商品订单中用户输入的收货人联系方式，主要是手机或固定电话信息</td>
    </tr>
</table>

对于以上敏感数据要进行数据的保护，根据目前系统的流程，主要分成以下三个部分  
* 数据展示：针对数据读取和显示时的要求  
* 数据存储：对数据保存时的要求  
* 数据传输：数据在网络传输时的要求  
上述三个部分在不同的数据类型中都会有不同的要求，下面针对部分，先给出基本的要求类别，后续在对应上述系统中的特定数据，确定每种数据的相关要求  

#### 5.4.2 数据展示  
数据展示主要在用户查询相关数据时，定义在相关展示界面或者终端中给对应用户的展示方式。针对普通数据的展示，一般会按照正常数据完全显示，对于隐私数据，由于当前查询人员的不同以及数据分类的差别，会分为
  * 许可展示
  * 部分展示
  * 不许可展示  

由于业务方面的差异，部分展示主要是针对不同权限或者业务要求的情况会针对不同的角色有定义。在本规范中，对于权限差别不做过多的区分，仅给出最低要求，即如果是部分展示，在系统和技术层面最多能够展示的方式和信息范围，如果产品或者业务有更多要求，可以在此基础上进一步强化。

<table>
		<tr>
				<th>类型</th>
				<th>信息</th>
				<th>用户访问</th>
        <th>权限用户</th>
        <th>其他用户</th>
        <th>部分显示规则（示例）</th>
		</tr>
		<tr>
				<th rowspan="5">个人信息</th>
				<td>姓名</td>
				<td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>证件信息</td>
				<td>部分显示</td>
        <td>部分显示</td>
        <td>不可显示</td>
        <td>例子：210101198001011234
            <br>前4位+后4位：2101 **** 1234
        </td>
		</tr>
		<tr>
				<td>手机号码</td>
				<td>部分显示</td>
        <td>部分显示</td>
        <td>部分显示</td>
        <td>前3+后4位</td>
		</tr>
		<tr>
				<td>Email</td>
				<td>部分显示</td>
        <td>部分显示</td>
        <td>部分显示</td>
        <td>第一位+@前一位+@及之后<br>myname@gmail.com：m***e@gmail.com
        </td>
		</tr>
		<tr>
				<td>联系地址</td>
				<td>部分显示</td>
        <td>部分显示</td>
        <td>不可显示</td>
        <td>省市区+地址前2字+最后2字<br>例子：上海市长宁区延安西路889号太平洋中心16楼：上海市长宁区延安***6楼
        </td>
		</tr>
		<tr>
				<th rowspan="3">账户信息</th>
				<td>登录名</td>
				<td>全部显示</td>
        <td>全部显示</td>
        <td>全部显示</td>
        <td>前3位+后1位</td>
		</tr>
		<tr>
				<td>安全问题</td>
				<td>问题全部显示，答案不可读，不可显示</td>
        <td>问题全部显示，答案不可读，不可显示</td>
        <td>问题不可显示，答案不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>卡号</td>
				<td>部分显示</td>
        <td>部分显示</td>
        <td>不可显示</td>
        <td>前4位+后4位</td>
		</tr>
		<tr>
				<th>商户</th>
				<td>商户信息</td>
				<td>全部显示</td>
        <td>部分显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<th rowspan="3">密码</th>
				<td>登录密码</td>
				<td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td></td>
		</tr>
		<tr>
				<td>支付密码</td>
				<td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td></td>
		</tr>
		<tr>
				<td>卡密码</td>
        <td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td>不可显示，不可读取</td>
        <td></td>
		</tr>
		<tr>
				<th rowspan="2">安全信息</th>
				<td>个人证书</td>
				<td>可显示证书号，证书内注册信息</td>
        <td>仅显示证书颁发用户名，证书号</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>商户证书</td>
        <td>可显示证书内注册信息</td>
        <td>仅显示证书颁发用户名，证书号</td>
        <td>不可显示</td>
        <td></td>
		<tr>
				<th rowspan="5">交易信息</th>
				<td>交易商品信息</td>
        <td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>交易流水号</td>
        <td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>交易金额</td>
				<td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>收获地址</td>
        <td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
		<tr>
				<td>收获人信息</td>
        <td>全部显示</td>
        <td>全部显示</td>
        <td>不可显示</td>
        <td></td>
		</tr>
</table>  

数据展示是在权限控制中相对会涉及问题较多的部分，因此在业务描述中需要更加精确，尤其是针对不同权限或者角色的用户访问时，会有不同的展示要求。  

#### 5.4.3 数据存储  
数据存储是指系统中对应的业务数据在数据库，文件或者相关存储中的记录方式。记录方式简单的区分为明文存储，密文存储（可解密），密文存储（不可解密）。密文存储所区分的可解密与不可解密的差别在于实际的明文信息到密文信息的运算过程是否可逆。本规范中暂不定义密文的操作方式，仅定义基本要求，主要用下面几点确认
  * 使用固定密钥
  * 密钥是否每用户不同
  * 对称或非对称加密
  * 存储位置
    * 客户端，用户的使用环境（包括浏览器，客户端应用等）
    * 第三方（合作伙伴，商户或银行等）
    * 系统内部

<table>
		<tr>
				<th>类型</th>
				<th>信息</th>
				<th>记录方式</th>
        <th>可存储位置</th>
		</tr>
		<tr>
				<th rowspan="5">个人信息</th>
				<td>姓名</td>
				<td>明文</td>
        <td>系统内部<br>业务许可的第三方</td>
		</tr>
		<tr>
				<td>证件信息</td>
				<td>明文</td>
        <td>系统内部<br>业务许可的第三方</td>
		</tr>
		<tr>
				<td>手机号码</td>
				<td>明文</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<td>Email</td>
				<td>明文</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<td>联系地址</td>
				<td>明文</td>
        <td>系统内部</td>
		</tr>
				<th rowspan="3">账户信息</th>
				<td>登录名</td>
				<td>明文</td>
        <td>系统内部<br>客户端</td>
		</tr>
		<tr>
				<td>安全问题</td>
				<td>问题明文<br>答案密问（不可解密）</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<td>卡号</td>
				<td>密文（可解密）</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<th>商户</th>
				<td>商户信息</td>
				<td>明文</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<th rowspan="3">密码</th>
				<td>登录密码</td>
				<td>密文（不可解密）</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<td>支付密码</td>
				<td>密文（不可解密）</td>
        <td>系统内部</td>
		</tr>
		<tr>
				<td>卡密码</td>
        <td>禁止存储</td>
        <td></td>
		</tr>
		<tr>
				<th rowspan="2">安全信息</th>
				<td>个人证书</td>
				<td>密文（可解密），或有保护的存储区域或设备中<br>个人证书或个人密钥</td>
        <td>系统内部<br>客户端<br>证书发放CA</td>
		<tr>
				<td>商户证书</td>
        <td>密文（可解密），或有保护的存储区域或设备中<br>商户证书或个人密钥</td>
        <td>系统内部<br>证书发放CA</td>
		<tr>
				<th rowspan="5">交易信息</th>
				<td>交易商品信息</td>
        <td>明文</td>
        <td>系统内部<br>供货商</td>
		</tr>
		<tr>
				<td>交易流水号</td>
        <td>明文</td>
        <td>系统内部<br>供货商<br>银行</td>
		</tr>
		<tr>
				<td>交易金额</td>
				<td>明文</td>
        <td>系统内部<br>供货商<br>银行</td>
		<tr>
				<td>收获地址</td>
        <td>明文</td>
        <td>系统内部<br>供货商</td>
		</tr>
		<tr>
				<td>收获人信息</td>
        <td>明文</td>
        <td>系统内部<br>供货商</td>
		</tr>
</table>  

#### 5.4.4 数据传输
系统主要的方式是基于B/S或C/S架构的多层应用，并且数据基于互联网传输，因此隐私数据需要在用户与系统以及第三方系统之间进行传输。传输过程中的数据保护也属于重要的范畴，该过程中，主要从以下几点进行定义，类似其他方面，这里定义每个过程中需要遵循的最低要求，可以在此要求基础上增强，但不可减弱。

数据传输的保障主要需要满足以下几个目标
*	数据防篡改，在传输中，防止因为人为或非人为的情况，造成数据在传输过程中被篡改而无法发现和验证
*	数据窃取，在传输过程中，防止其他人为方式获取传输的数据，造成数据丢失

数据传输保护描述点
*	传输方向，传输方向以系统为中心，传入表示从其他系统向公司系统发送数据的方向，传出表示从公司系统向其他系统发出数据的方向
*	传输层加密，表示在网络传输协议中，传输层是否使用加密通道连接方式，目前系统使用较多的是基于TCP/IP网络的传输，因此在传输层可用的标准加密通道有SSL和TLS等几种，这些加密通道同时还分为单向验证（服务端，被请求连接方需要有证书用以建立加密通道，服务端可通过证书验证）和双向验证（服务端和客户端，双方都需要提供证书用以建立加密通道，双方都可以通过证书验证）
*	应用层加密，在服务层基础上，传输的数据协议自己定义加密和验证方式
*	签名，使用证书签名，防止传输过程中的数据篡改
*	许可传输，对应的数据是否可以在网络进行传输  

下表中没有单独描述的表示没有特定最低要求，可传输，可明文
<table>
		<tr>
				<th>类型</th>
				<th>信息</th>
				<th>用户访问</th>
        <th>权限用户</th>
		</tr>
		<tr>
				<th rowspan="5">个人信息</th>
				<td>姓名</td>
				<td></td>
        <td></td>
		</tr>
		<tr>
				<td>证件信息</td>
				<td>传输层加密</td>
        <td>不可全部明文传输<br>符合数据展示内容传输</td>
		</tr>
		<tr>
				<td>手机号码</td>
				<td></td>
        <td>不可全部明文传输<br>符合数据展示内容传输</td>
    </tr>
		<tr>
				<td>Email</td>
				<td></td>
        <td>不可全部明文传输<br>符合数据展示内容传输</td>
		</tr>
		<tr>
				<td>联系地址</td>
				<td></td>
        <td></td>
		</tr>
				<th rowspan="3">账户信息</th>
				<td>登录名</td>
				<td></td>
        <td></td>
		</tr>
		<tr>
				<td>安全问题</td>
				<td>传输层加密</td>
        <td>不可传输</td>
		</tr>
		<tr>
				<td>卡号</td>
				<td>传输层加密<br>数据层加密<br>签名</td>
        <td>传输层加密<br>数据层加密<br>签名</td>
		</tr>
		<tr>
				<th>商户</th>
				<td>商户信息</td>
				<td>传输层加密<br>签名</td>
        <td>符合数据展示内容传输</td>
		</tr>
		<tr>
				<th rowspan="3">密码</th>
				<td>登录密码</td>
				<td>传输层加密<br>数据层加密</td>
        <td>不可传输</td>
		</tr>
		<tr>
				<td>支付密码</td>
				<td>传输层加密<br>数据层加密</td>
        <td>不可传输</td>
		</tr>
		<tr>
				<td>卡密码</td>
        <td>传输层加密<br>数据层加密</td>
        <td>指定渠道可传输<br>其他渠道不可传输</td>
		</tr>
		<tr>
				<th rowspan="2">安全信息</th>
				<td>个人证书</td>
				<td>不可传输</td>
        <td>特定通道 或 传输层加密<br>数据层加密</td>
		<tr>
				<td>商户证书</td>
        <td>不可传输</td>
        <td>特定通道 或 传输层加密<br>数据层加密</td>
		<tr>
				<th rowspan="5">交易信息</th>
				<td>交易商品信息</td>
        <td></td>
        <td></td>
		</tr>
		<tr>
				<td>交易流水号</td>
        <td></td>
        <td></td>
		</tr>
		<tr>
				<td>交易金额</td>
				<td></td>
        <td></td>
		<tr>
				<td>收获地址</td>
        <td></td>
        <td>符合数据展示内容传输</td>
		</tr>
		<tr>
				<td>收获人信息</td>
        <td></td>
        <td>符合数据展示内容传输</td>
		</tr>
</table>
